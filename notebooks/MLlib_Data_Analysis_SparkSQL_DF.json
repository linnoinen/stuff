{"paragraphs":[{"text":"%md\n# Data analysis w/ Spark SQL and Data Frames","user":"klinnoinen","dateUpdated":"2018-02-19T14:02:53+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"markdown","editOnDblClick":true},"editorMode":"ace/mode/markdown","editorHide":true,"tableHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706262531_-1864790125","id":"20180215-145102_1643855516","dateCreated":"2018-02-15T14:51:02+0000","dateStarted":"2018-02-19T14:02:53+0000","dateFinished":"2018-02-19T14:02:53+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:21424","results":{"code":"SUCCESS","msg":[{"type":"HTML","data":"<div class=\"markdown-body\">\n<h1>Data analysis w/ Spark SQL and Data Frames</h1>\n</div>"}]}},{"text":"%spark2.pyspark\ndata_file = \"/tmp/kddcup.data_10_percent.gz\"\nraw_data = sc.textFile(data_file).cache()","user":"klinnoinen","dateUpdated":"2018-02-15T14:51:42+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706283132_1961568335","id":"20180215-145123_1878763306","dateCreated":"2018-02-15T14:51:23+0000","dateStarted":"2018-02-15T14:51:42+0000","dateFinished":"2018-02-15T14:51:42+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21425"},{"text":"%spark2.pyspark\nfrom pyspark.sql import SQLContext\nsqlContext = SQLContext(sc)\n","user":"klinnoinen","dateUpdated":"2018-02-15T14:51:51+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706302308_-470598029","id":"20180215-145142_1931944360","dateCreated":"2018-02-15T14:51:42+0000","dateStarted":"2018-02-15T14:51:51+0000","dateFinished":"2018-02-15T14:51:51+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21426"},{"text":"%spark2.pyspark\nfrom pyspark.sql import Row\n\ncsv_data = raw_data.map(lambda l: l.split(\",\"))\nrow_data = csv_data.map(lambda p: Row(\n    duration=int(p[0]), \n    protocol_type=p[1],\n    service=p[2],\n    flag=p[3],\n    src_bytes=int(p[4]),\n    dst_bytes=int(p[5])\n    )\n)","user":"klinnoinen","dateUpdated":"2018-02-15T14:52:02+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706311224_-223558586","id":"20180215-145151_1233603768","dateCreated":"2018-02-15T14:51:51+0000","dateStarted":"2018-02-15T14:52:02+0000","dateFinished":"2018-02-15T14:52:02+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21427"},{"text":"%spark2.pyspark\ninteractions_df = sqlContext.createDataFrame(row_data)\ninteractions_df.registerTempTable(\"interactions\")","user":"klinnoinen","dateUpdated":"2018-02-15T14:52:11+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706322059_1566308621","id":"20180215-145202_500432850","dateCreated":"2018-02-15T14:52:02+0000","dateStarted":"2018-02-15T14:52:11+0000","dateFinished":"2018-02-15T14:52:12+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21428"},{"text":"%spark2.pyspark\ntcp_interactions = sqlContext.sql(\"\"\"\n    SELECT duration, dst_bytes FROM interactions WHERE protocol_type = 'tcp' AND duration > 1000 AND dst_bytes = 0\n\"\"\")\ntcp_interactions.show()","user":"klinnoinen","dateUpdated":"2018-02-15T14:52:31+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706331315_-1982615233","id":"20180215-145211_1471311725","dateCreated":"2018-02-15T14:52:11+0000","dateStarted":"2018-02-15T14:52:31+0000","dateFinished":"2018-02-15T14:52:34+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21429"},{"text":"%spark2.pyspark\n# Output duration together with dst_bytes\ntcp_interactions_out = tcp_interactions.map(lambda p: \"Duration: {}, Dest. bytes: {}\".format(p.duration, p.dst_bytes))\nfor ti_out in tcp_interactions_out.collect():\n  print ti_out","user":"klinnoinen","dateUpdated":"2018-02-15T14:52:47+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706351891_1941084698","id":"20180215-145231_1965045418","dateCreated":"2018-02-15T14:52:31+0000","dateStarted":"2018-02-15T14:52:48+0000","dateFinished":"2018-02-15T14:52:48+0000","status":"ERROR","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21430"},{"text":"%spark2.pyspark\ninteractions_df.printSchema()\n","user":"klinnoinen","dateUpdated":"2018-02-15T14:53:22+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706367983_-834711695","id":"20180215-145247_1079022501","dateCreated":"2018-02-15T14:52:47+0000","dateStarted":"2018-02-15T14:53:22+0000","dateFinished":"2018-02-15T14:53:22+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21431"},{"text":"%spark2.pyspark\nfrom time import time\n\nt0 = time()\ninteractions_df.select(\"protocol_type\", \"duration\", \"dst_bytes\").groupBy(\"protocol_type\").count().show()\ntt = time() - t0\n\nprint \"Query performed in {} seconds\".format(round(tt,3))\n","user":"klinnoinen","dateUpdated":"2018-02-15T14:53:29+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706402123_-1616460163","id":"20180215-145322_399644405","dateCreated":"2018-02-15T14:53:22+0000","dateStarted":"2018-02-15T14:53:29+0000","dateFinished":"2018-02-15T14:53:38+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21432"},{"text":"%spark2.pyspark\nt0 = time()\ninteractions_df.select(\"protocol_type\", \"duration\", \"dst_bytes\").filter(interactions_df.duration>1000).filter(interactions_df.dst_bytes==0).groupBy(\"protocol_type\").count().show()\ntt = time() - t0\n\nprint \"Query performed in {} seconds\".format(round(tt,3))\n","user":"klinnoinen","dateUpdated":"2018-02-15T14:53:54+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706409261_363457677","id":"20180215-145329_236657119","dateCreated":"2018-02-15T14:53:29+0000","dateStarted":"2018-02-15T14:53:54+0000","dateFinished":"2018-02-15T14:54:02+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21433"},{"text":"%spark2.pyspark\ndef get_label_type(label):\n    if label!=\"normal.\":\n        return \"attack\"\n    else:\n        return \"normal\"\n    \nrow_labeled_data = csv_data.map(lambda p: Row(\n    duration=int(p[0]), \n    protocol_type=p[1],\n    service=p[2],\n    flag=p[3],\n    src_bytes=int(p[4]),\n    dst_bytes=int(p[5]),\n    label=get_label_type(p[41])\n    )\n)\ninteractions_labeled_df = sqlContext.createDataFrame(row_labeled_data)","user":"klinnoinen","dateUpdated":"2018-02-15T14:54:26+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706429671_1037015083","id":"20180215-145349_604113627","dateCreated":"2018-02-15T14:53:49+0000","dateStarted":"2018-02-15T14:54:26+0000","dateFinished":"2018-02-15T14:54:26+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21434"},{"text":"%spark2.pyspark\nt0 = time()\ninteractions_labeled_df.select(\"label\").groupBy(\"label\").count().show()\ntt = time() - t0\n\nprint \"Query performed in {} seconds\".format(round(tt,3))","user":"klinnoinen","dateUpdated":"2018-02-15T14:54:30+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706429099_1257091454","id":"20180215-145349_1583540678","dateCreated":"2018-02-15T14:53:49+0000","dateStarted":"2018-02-15T14:54:30+0000","dateFinished":"2018-02-15T14:54:38+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21435"},{"text":"%spark2.pyspark\nt0 = time()\ninteractions_labeled_df.select(\"label\", \"protocol_type\").groupBy(\"label\", \"protocol_type\").count().show()\ntt = time() - t0\n\nprint \"Query performed in {} seconds\".format(round(tt,3))","user":"klinnoinen","dateUpdated":"2018-02-15T14:55:49+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706447719_62461444","id":"20180215-145407_924939601","dateCreated":"2018-02-15T14:54:07+0000","dateStarted":"2018-02-15T14:55:49+0000","dateFinished":"2018-02-15T14:55:57+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21436"},{"text":"%spark2.pyspark\nt0 = time()\ninteractions_labeled_df.select(\"label\", \"protocol_type\", \"dst_bytes\").groupBy(\"label\", \"protocol_type\", interactions_labeled_df.dst_bytes==0).count().show()\ntt = time() - t0\n\nprint \"Query performed in {} seconds\".format(round(tt,3))","user":"klinnoinen","dateUpdated":"2018-02-15T14:56:00+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706455630_1116688754","id":"20180215-145415_1822405421","dateCreated":"2018-02-15T14:54:15+0000","dateStarted":"2018-02-15T14:56:00+0000","dateFinished":"2018-02-15T14:56:09+0000","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21437"},{"text":"%spark2.pyspark\n","user":"klinnoinen","dateUpdated":"2018-02-15T14:56:00+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python"},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1518706560918_69187710","id":"20180215-145600_1187418403","dateCreated":"2018-02-15T14:56:00+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:21438"}],"name":"/Development/MLlib 4","id":"2D6B81HFT","angularObjects":{"2C8A4SZ9T_livy2:shared_process":[],"2D65U3YVP:klinnoinen:":[],"2D8CEQZQG:shared_process":[],"2D8GMAMUB:shared_process":[],"2C4U48MY3_spark2:shared_process":[],"2D5W64A4H:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}